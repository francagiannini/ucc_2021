---
title: "Distribuciones en R"
output:
  word_document: default
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Computo de probabilidades

Para todas las variables aleatorias que hemos mencionado hasta ahora (춰y muchas m치s!), R ha incorporado capacidades de c치lculo de probabilidades. La sintaxis se divide en dos partes: la ra칤z y el prefijo. La ra칤z determina de qu칠 variable aleatoria estamos hablando, y aqu칤 est치n los nombres de las que hemos cubierto hasta ahora:

-   `binom` binomial
-   `geom` geometrica
-   `pois` Poisson
-   `unif` uniforme
-   `exp` nexponencial
-   `norm` normal

Y los prefijos disponibles son los siguientes:

-   `p` computa la **distribuci칩n acumulada**
-   `d` computa la **distribuci칩n de probabilidad** o **distribuci칩n de densidad**\
-   `r` muestrea
-   `q` es la distribuci칩n cuantil

Por el momento nos vamos a enfocar en `p` y `d`

Por ejemplo si $X$ es una variable aleatoria que se distribuye binomial con $n=10$ y $p=0.3$ y queremos computar $P(X=5)$ entonces:

```{r}
dbinom(5, 10, 0.3)
```

Recordemos que siempre podemos pedir la ayuda de la funci칩n para ver cuales son sus par치metros

Si queremos ahora calcular $P(1\leqslant X \leqslant 5)$ podemos hacerlo de dos maneras:

*Opci칩n 1*

$$P(X = 1) + P(X = 2) + P(X = 3) + P(X = 4) + P(X = 5)$$

```{r}
dbinom(5, 10, 0.3) +
  dbinom(4, 10, 0.3) +
  dbinom(3, 10, 0.3) +
  dbinom(2, 10, 0.3) +
  dbinom(1, 10, 0.3)
```

Para no volvernos viejos tan r치pido podemos usar la opci칩n de `dbinom` tambi칠n permite vectores como argumentos, por lo que podemos calcular todas las probabilidades necesarias de esta manera:

*Opci칩n 2*

```{r}
dbinom(1:5, 10, 0.3)

sum(dbinom(1:5, 10 , 0.3))
```

## Algunos ejemplos con COVID 19

Para comenzar vamos a obtener una serie de datos de la p치gina oficial de la OMS o [WHO](https://covid19.who.int/info)

Vamos a tratar de responder algunos interrogantes respecto a la incidencia de la enfermedad

Trabajaremos con los datos totales y de los 칰ltimos 7 d칤as, debemos elegir Argentina y un pa칤s de cada region

Definimos Prevalencia como la proporci칩n de individuos de un grupo o una poblaci칩n (en medicina, persona), que presentan una caracter칤stica o evento determinado (en medicina, enfermedades). Por lo general, se expresa como una fracci칩n, un porcentaje o un n칰mero de casos por cada 10 000 o 100.000 personas.

Mientras que la incidencia es el n칰mero de casos nuevos de una enfermedad en una poblaci칩n determinada y en un periodo determinado.

Definimos la Incidencia para un periodo de tiempo dado como:

$$Incidencia= \frac{numero.de.personas.enfermas}{numero.de.habitantes}$$

La prevalencia es un t칠rmino que significa estar extendido y es distinto de la incidencia .

La prevalencia es una medida de todos los individuos (casos) afectados por la enfermedad en un momento determinado, mientras que la incidencia es una medida del n칰mero de nuevos individuos (casos) que contraen una enfermedad durante un per칤odo de tiempo particular.

La prevalencia responde a "쮺u치ntas personas tienen esta enfermedad en este momento?" o "쮺u치ntas personas han tenido esta enfermedad durante este per칤odo de tiempo?". La incidencia responde a "쮺u치ntas personas adquirieron la enfermedad durante un per칤odo de tiempo espec칤fico?". Sin embargo, matem치ticamente, la prevalencia es proporcional al producto de la incidencia y la duraci칩n promedio de la enfermedad.

$$ Prevalencia  = Incidencia* duraci칩n$$

쮺u치l es la probabilidad de que una persona contraiga la enfermdad en los 칰ltimos 7 d칤as?

Asumimos una distribuci칩n Bernoulli o binomial con n=1

$$P(X=x)=p^x (1-p)^{(n-x)}$$ con

$$洧논={0,1}$$

Aqui $p$ tomar치 el valor de la incidencia media y $x$ sera 1

Entonces por ejemplo para el mundo con una incidencia de $\frac{58.848}{100000}=0.00058848$ :

```{r}
dbinom(x=1, size=1, prob=58.848/100000)
```

Obviamente observando la formula podiamos darnos cuenta que ese valor iba a ser igual a $p$

쮸hora, cu치l es la probabilidad de que un integrante de una burbuja de 15 personas contraiga la enfermdad en los 칰ltimos 7 d칤as?

```{r}
dbinom(x=1, size=15, prob=(58.848/100000))

```

y dos?

```{r}
dbinom(x=2, size=15, prob=58.848/100000)
```

쯈u칠 pasa en Argentina y en los paises seleccionados de cada regi칩n?

Comparar en Argentina $p$ total, de los ultimos 7 d칤as y de las 칰ltimas 24 hs.

## Variables continuas

Ahora, siendo $X$ una v.a. de media 1 ($\mu=1$) y desv칤o estandar 5 ($\sigma = 5$) y queremos calcular $P(X\leqslant 1)$

Como se trata de una distribuci칩n de variables continuas es complejo calcular probabilidades como el ejemplo anterior, aqu칤 tenemos que integrar. Entoncess:

$$\int_{-\infty}^1 {\text { N(x, 1, 5)}} \, dx$$ Pero, la probabilidad que estamos tratando de calcular podemos computarla a traves de $F(x)$ usando `pnorm`.

```{r}
pnorm(1,1,5)
```

Si queremos calcular $P(1 \le X \le 5)$ Aqu칤, calculamos la probabilidad de que $X$ sea menor o igual a cinco, y restamos la probabilidad de que $X$ sea menor que 1. Que es lo mismo que:

$$P(X \le 5) - P(X \le 1) $$

```{r}

```

pnorm(5,1,5) - pnorm(1,1,5)

*Ejemplo*

Debemos elegir siete mujeres al azar de una universidad para formar una versi칩n inicial de un video juego de basquet femenino. Las alturas de las mujeres en se distribuyen normalmente con una media de 163.83 cm y una desviaci칩n est치ndar de 5.715 cm.

쮺u치l es la probabilidad de que 3 o m치s de las mujeres midan 172.72 cm o m치s?

Para computar esta probabilidad, primero determinamos la probabilidad de que una sola mujer seleccionada al azar mida 172.72 cm o m치s alta. Sea $X$ una variable aleatoria normal con media 162.56 y desviaci칩n est치ndar 5.715. Calculamos $P(X \ge 172.72)$ usando `pnorm`:

```{r}
pnorm(172.72, 162.56, 5.715)#, lower.tail = FALSE

1-pnorm(172.72, 162.56, 5.715)
```

Ahora, tenemos que calcular la probabilidad de que 3 o m치s de las 7 mujeres midan 172.72 cm o m치s. Dado que la poblaci칩n de todas las mujeres en una universidad es mucho mayor que 7, el n칰mero de mujeres en la configurac칩n inicial que tienen 172.72 cm o m치s es binomial con $n = 7$ y $p=0.03772018$, que calculamos en el paso anterior. Entonces, calculamos la probabilidad de que al menos 3 mujeres midan 172.72 cm como:

```{r}
sum(dbinom(3:7, 7, 0.03772018))
```

Por lo tanto, hay aproximadamente un $0.17$ por ciento de posibilidades de que al menos tres mujeres midan 172.72 cm o m치s.

\pagebreak

*Graficar funciones con ggplot2*

Para graficar la funci칩n de densidad del ejemplo anterior, vamos a generar una serie de datos (vector) de datos con los valores de $x$ y los valores de $y$ que queremos representar (usando la funci칩n `dnorm()`) y a partir de ese vector vamos a graficar usando `geom_line()`, de la siguiente manera.

```{r}
library(ggplot2)

xvals <- seq(120,200,5)# 120:200

plotdata <- data.frame(x = xvals, y = dnorm(xvals, 162.56, 5.715))

ggplot(plotdata, aes(x = x, y = y)) +
  geom_line()+
  labs(x="altura (cm)", y= "f(x)", title="Distribuci칩n Normal(162.56, 5.715)")

```

\pagebreak

De la misma manera si se trata de una distribuci칩n binomial

```{r}
xvals <- 0:7

plotdata <- data.frame(x = xvals, y = dbinom(xvals, 7, 0.03772018))

ggplot(plotdata, aes(x, y)) + 
  geom_bar(stat = "identity")+
  labs(x="altura (cm)", y= "f(X)", title="Distribuci칩n Binomial(7; 0,037)")
```

*Otras opciones para variables continuas*

```{r}
curve(dgamma(x, scale=1.5, shape=3),from=0, to=15, main="distribuci칩n Gamma")

curve(dunif(x,min=0,max=10), main="distribuci칩n uniforme")

curve(dnorm(x,m=0,sd=1),from=-1,to=1,main="distribuci칩n Normal")
```

*Ejemplo Salario neto mensual*

Veamos el comportamiento de la variable salario neto

```{r, message=FALSE, include=FALSE}
library(tidyverse)
library(readxl)

sueldossys <- read_excel("datos/sys2021.xlsx")

salario_neto_gen <- sueldossys %>%
rename(neto =`Salario mensual o retiro NETO (en tu moneda local)`) %>%
filter(neto< 500000 & neto>10000) %>%
select(c(neto,`Me identifico`)) %>%
mutate(genero = fct_lump(`Me identifico`, n = 2, other_level = "Otre"))
```

```{r}
head(salario_neto_gen)
```

Funci칩n de densidad

```{r}
plot(density(salario_neto_gen$neto), main='', lwd=5, las=1,
     xlab='Salario', ylab='Densidad')
```

Con ggplot2 por genero

```{r}
ggplot(salario_neto_gen, aes(x=neto)) + 
  geom_density(aes(group=genero, fill=genero), alpha=0.5)
```

Funci칩n de distribuci칩n acumulada

```{r}

F <- ecdf(salario_neto_gen$neto)
plot(F, main='', xlab='Salario', ylab='F(x)', cex=0.5, las=1)

```

Con ggplot2 por genero

```{r}
ggplot(salario_neto_gen, aes(neto, fill=genero, col=genero))+
  geom_step(stat="ecdf") +
  ylab("Frecuencia acumulada")+
  xlab("Salario neto mensual")
```

Calcular la probabilidad de que una persona de la industria del software cobre un sueldo inferior al salario minimo vital y movil.

SMVM = 21600

```{r}
F(21600)
```

# TCL

## Media muestral del salario

Ahora muestreamos 10 individuos y calculamos la media del salario sobre esos 10 individuos

Muestreo una vez una muestra de tama침o 10

```{r}
muestra_size10_1 <- sample(salario_neto_gen$neto, size=10)
```

Calculo la media

```{r}
mean(muestra_size10_1)
```

Repito el proceso 100 veces

```{r}
medias_muestralesrep100n100 <- replicate(100, mean(sample(salario_neto_gen$neto, size=100)))

plot(density(medias_muestrales), main='', lwd=5, las=1,
     xlab='Media muestral Salario n=10 replicas=100', ylab='Densidad')

mean(medias_muestrales)
sd(medias_muestrales)
```

Ahora lo repito 1000 veces y 100000 veces

```{r}
medias_muestralesrep1000n100 <- replicate(1000, mean(sample(salario_neto_gen$neto, size=100)))

plot(density(medias_muestrales), main='', lwd=5, las=1,
     xlab='Media muestral Salario n=10 replicas=1000', ylab='Densidad')

mean(medias_muestrales)
sd(medias_muestrales)

medias_muestralesrep10000n100 <- replicate(10000, mean(sample(salario_neto_gen$neto, size=100)))

plot(density(medias_muestrales), main='', lwd=5, las=1,
     xlab='Media muestral Salario n=10 replicas=100000', ylab='Densidad')

mean(medias_muestrales)

sd(medias_muestrales)

```

Repetir el proceso para un tama침o mestral de 20 y un tama침o mestral de 100, calculando media y desvio estandar para cada caso. Construir una tabla y concluir.

```{r}
# Ayuda usar tibble

tcl_table <- tibble(n = c(10,10,10,20,20,20,100,100,100), 
                    replicate= c(100,1000,10000,100,1000,10000,100,1000,10000), 
                    mean= c(mean(medias_muestralesrep100n10),
                            mean(medias_muestralesrep1000n10),
                            mean(medias_muestralesrep10000n10),
                            mean(medias_muestralesrep100n20),
                            mean(medias_muestralesrep1000n20),
                            mean(medias_muestralesrep10000n20),
                            mean(medias_muestralesrep100n100),
                            mean(medias_muestralesrep1000n100),
                            mean(medias_muestralesrep10000n100)
                      
                    ), 
                    
                    sd= c(sd(medias_muestralesrep100n10),
                            sd(medias_muestralesrep1000n10),
                            sd(medias_muestralesrep10000n10),
                            sd(medias_muestralesrep100n20),
                            sd(medias_muestralesrep1000n20),
                            sd(medias_muestralesrep10000n20),
                            sd(medias_muestralesrep100n100),
                            sd(medias_muestralesrep1000n100),
                            sd(medias_muestralesrep10000n100))
                    )

ggplot(tcl_table, aes(x=sd,y=n, fill=as.factor(replicate)))+
  geom_point()



curve(d)
```
